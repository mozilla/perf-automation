"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _QuestionDialog = _interopRequireDefault(require("./QuestionDialog"));

var _languageHandler = require("../../../languageHandler");

var _Field = _interopRequireDefault(require("../elements/Field"));

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _CountlyAnalytics = _interopRequireDefault(require("../../../CountlyAnalytics"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var _BugReportDialog = _interopRequireDefault(require("./BugReportDialog"));

var _InfoDialog = _interopRequireDefault(require("./InfoDialog"));

var _StyledRadioGroup = _interopRequireDefault(require("../elements/StyledRadioGroup"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/*
Copyright 2018 New Vector Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const existingIssuesUrl = "https://github.com/vector-im/element-web/issues" + "?q=is%3Aopen+is%3Aissue+sort%3Areactions-%2B1-desc";
const newIssueUrl = "https://github.com/vector-im/element-web/issues/new/choose";

const FeedbackDialog = props => {
  const [rating, setRating] = (0, _react.useState)();
  const [comment, setComment] = (0, _react.useState)("");

  const onDebugLogsLinkClick = () => {
    props.onFinished();

    _Modal.default.createTrackedDialog('Bug Report Dialog', '', _BugReportDialog.default, {});
  };

  const hasFeedback = _CountlyAnalytics.default.instance.canEnable();

  const onFinished = sendFeedback => {
    if (hasFeedback && sendFeedback) {
      _CountlyAnalytics.default.instance.reportFeedback(rating, comment);

      _Modal.default.createTrackedDialog('Feedback sent', '', _InfoDialog.default, {
        title: (0, _languageHandler._t)('Feedback sent'),
        description: (0, _languageHandler._t)('Thank you!')
      });
    }

    props.onFinished();
  };

  const brand = _SdkConfig.default.get().brand;

  let countlyFeedbackSection;

  if (hasFeedback) {
    countlyFeedbackSection = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement("hr", null), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_FeedbackDialog_section mx_FeedbackDialog_rateApp"
    }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Rate %(brand)s", {
      brand
    })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Tell us below how you feel about %(brand)s so far.", {
      brand
    })), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Please go into as much detail as you like, so we can track down the problem.")), /*#__PURE__*/_react.default.createElement(_StyledRadioGroup.default, {
      name: "feedbackRating",
      value: String(rating),
      onChange: r => setRating(parseInt(r, 10)),
      definitions: [{
        value: "1",
        label: "ðŸ˜ "
      }, {
        value: "2",
        label: "ðŸ˜ž"
      }, {
        value: "3",
        label: "ðŸ˜‘"
      }, {
        value: "4",
        label: "ðŸ˜„"
      }, {
        value: "5",
        label: "ðŸ˜"
      }]
    }), /*#__PURE__*/_react.default.createElement(_Field.default, {
      id: "feedbackComment",
      label: (0, _languageHandler._t)("Add comment"),
      placeholder: (0, _languageHandler._t)("Comment"),
      type: "text",
      autoComplete: "off",
      value: comment,
      element: "textarea",
      onChange: ev => {
        setComment(ev.target.value);
      }
    })));
  }

  let subheading;

  if (hasFeedback) {
    subheading = /*#__PURE__*/_react.default.createElement("h2", null, (0, _languageHandler._t)("There are two ways you can provide feedback and help us improve %(brand)s.", {
      brand
    }));
  }

  let bugReports = null;

  if (_SdkConfig.default.get().bug_report_endpoint_url) {
    bugReports = /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("PRO TIP: If you start a bug, please submit <debugLogsLink>debug logs</debugLogsLink> " + "to help us track down the problem.", {}, {
      debugLogsLink: sub => /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
        kind: "link",
        onClick: onDebugLogsLinkClick
      }, sub)
    }));
  }

  return /*#__PURE__*/_react.default.createElement(_QuestionDialog.default, {
    className: "mx_FeedbackDialog",
    hasCancelButton: !!hasFeedback,
    title: (0, _languageHandler._t)("Feedback"),
    description: /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, subheading, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_FeedbackDialog_section mx_FeedbackDialog_reportBug"
    }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Report a bug")), /*#__PURE__*/_react.default.createElement("p", null, (0, _languageHandler._t)("Please view <existingIssuesLink>existing bugs on Github</existingIssuesLink> first. " + "No match? <newIssueLink>Start a new one</newIssueLink>.", {}, {
      existingIssuesLink: sub => {
        return /*#__PURE__*/_react.default.createElement("a", {
          target: "_blank",
          rel: "noreferrer noopener",
          href: existingIssuesUrl
        }, sub);
      },
      newIssueLink: sub => {
        return /*#__PURE__*/_react.default.createElement("a", {
          target: "_blank",
          rel: "noreferrer noopener",
          href: newIssueUrl
        }, sub);
      }
    })), bugReports), countlyFeedbackSection),
    button: hasFeedback ? (0, _languageHandler._t)("Send feedback") : (0, _languageHandler._t)("Go back"),
    buttonDisabled: hasFeedback && !rating,
    onFinished: onFinished
  });
};

var _default = FeedbackDialog;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvRmVlZGJhY2tEaWFsb2cudHN4Il0sIm5hbWVzIjpbImV4aXN0aW5nSXNzdWVzVXJsIiwibmV3SXNzdWVVcmwiLCJGZWVkYmFja0RpYWxvZyIsInByb3BzIiwicmF0aW5nIiwic2V0UmF0aW5nIiwiY29tbWVudCIsInNldENvbW1lbnQiLCJvbkRlYnVnTG9nc0xpbmtDbGljayIsIm9uRmluaXNoZWQiLCJNb2RhbCIsImNyZWF0ZVRyYWNrZWREaWFsb2ciLCJCdWdSZXBvcnREaWFsb2ciLCJoYXNGZWVkYmFjayIsIkNvdW50bHlBbmFseXRpY3MiLCJpbnN0YW5jZSIsImNhbkVuYWJsZSIsInNlbmRGZWVkYmFjayIsInJlcG9ydEZlZWRiYWNrIiwiSW5mb0RpYWxvZyIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJicmFuZCIsIlNka0NvbmZpZyIsImdldCIsImNvdW50bHlGZWVkYmFja1NlY3Rpb24iLCJTdHJpbmciLCJyIiwicGFyc2VJbnQiLCJ2YWx1ZSIsImxhYmVsIiwiZXYiLCJ0YXJnZXQiLCJzdWJoZWFkaW5nIiwiYnVnUmVwb3J0cyIsImJ1Z19yZXBvcnRfZW5kcG9pbnRfdXJsIiwiZGVidWdMb2dzTGluayIsInN1YiIsImV4aXN0aW5nSXNzdWVzTGluayIsIm5ld0lzc3VlTGluayJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUExQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZUEsTUFBTUEsaUJBQWlCLEdBQUcsb0RBQ3RCLG9EQURKO0FBRUEsTUFBTUMsV0FBVyxHQUFHLDREQUFwQjs7QUFJQSxNQUFNQyxjQUFnQyxHQUFJQyxLQUFELElBQW1CO0FBQ3hELFFBQU0s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LElBQVM7QUFDbkIsNEJBQU87QUFBRyxVQUFBLE1BQU0sRUFBQyxRQUFWO0FBQW1CLFVBQUEsR0FBRyxFQUFDLHFCQUF2QjtBQUE2QyxVQUFBLElBQUksRUFBRXBDO0FBQW5ELFdBQWtFb0MsR0FBbEUsQ0FBUDtBQUNIO0FBTjhELEtBRG5FLENBREosQ0FGSixFQWFNSCxVQWJOLENBSFMsRUFrQlBULHNCQWxCTyxDQUpUO0FBd0JKLElBQUEsTUFBTSxFQUFFWixXQUFXLEdBQUcseUJBQUcsZUFBSCxDQUFILEdBQXlCLHlCQUFHLFNBQUgsQ0F4QnhDO0FBeUJKLElBQUEsY0FBYyxFQUFFQSxXQUFXLElBQUksQ0FBQ1QsTUF6QjVCO0FBMEJKLElBQUEsVUFBVSxFQUFFSztBQTFCUixJQUFSO0FBNEJILENBL0dEOztlQWlIZVAsYyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOCBOZXcgVmVjdG9yIEx0ZFxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBRdWVzdGlvbkRpYWxvZyBmcm9tICcuL1F1ZXN0aW9uRGlhbG9nJztcbmltcG9ydCB7IF90IH0gZnJvbSAnLi4vLi4vLi4vbGFuZ3VhZ2VIYW5kbGVyJztcbmltcG9ydCBGaWVsZCBmcm9tIFwiLi4vZWxlbWVudHMvRmllbGRcIjtcbmltcG9ydCBBY2Nlc3NpYmxlQnV0dG9uIGZyb20gXCIuLi9lbGVtZW50cy9BY2Nlc3NpYmxlQnV0dG9uXCI7XG5pbXBvcnQgQ291bnRseUFuYWx5dGljcywgeyBSYXRpbmcgfSBmcm9tIFwiLi4vLi4vLi4vQ291bnRseUFuYWx5dGljc1wiO1xuaW1wb3J0IFNka0NvbmZpZyBmcm9tIFwiLi4vLi4vLi4vU2RrQ29uZmlnXCI7XG5pbXBvcnQgTW9kYWwgZnJvbSBcIi4uLy4uLy4uL01vZGFsXCI7XG5pbXBvcnQgQnVnUmVwb3J0RGlhbG9nIGZyb20gXCIuL0J1Z1JlcG9ydERpYWxvZ1wiO1xuaW1wb3J0IEluZm9EaWFsb2cgZnJvbSBcIi4vSW5mb0RpYWxvZ1wiO1xuaW1wb3J0IFN0eWxlZFJhZGlvR3JvdXAgZnJvbSBcIi4uL2VsZW1lbnRzL1N0eWxlZFJhZGlvR3JvdXBcIjtcbmltcG9ydCB7IElEaWFsb2dQcm9wcyB9IGZyb20gXCIuL0lEaWFsb2dQcm9wc1wiO1xuXG5jb25zdCBleGlzdGluZ0lzc3Vlc1VybCA9IFwiaHR0cHM6Ly9naXRodWIuY29tL3ZlY3Rvci1pbS9lbGVtZW50LXdlYi9pc3N1ZXNcIiArXG4gICAgXCI/cT1pcyUzQW9wZW4raXMlM0Fpc3N1ZStzb3J0JTNBcmVhY3Rpb25zLSUyQjEtZGVzY1wiO1xuY29uc3QgbmV3SXNzdWVVcmwgPSBcImh0dHBzOi8vZ2l0aHViLmNvbS92ZWN0b3ItaW0vZWxlbWVudC13ZWIvaXNzdWVzL25ldy9jaG9vc2VcIjtcblxuaW50ZXJmYWNlIElQcm9wcyBleHRlbmRzIElEaWFsb2dQcm9wcyB7fVxuXG5jb25zdCBGZWVkYmFja0RpYWxvZzogUmVhY3QuRkM8SVByb3BzPiA9IChwcm9wczogSVByb3BzKSA9PiB7XG4gICAgY29uc3QgW3JhdGluZywgc2V0UmF0aW5nXSA9IHVzZVN0YXRlPFJhdGluZz4oKTtcbiAgICBjb25zdCBbY29tbWVudCwgc2V0Q29tbWVudF0gPSB1c2VTdGF0ZTxzdHJpbmc+KFwiXCIpO1xuXG4gICAgY29uc3Qgb25EZWJ1Z0xvZ3NMaW5rQ2xpY2sgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHByb3BzLm9uRmluaXNoZWQoKTtcbiAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnQnVnIFJlcG9ydCBEaWFsb2cnLCAnJywgQnVnUmVwb3J0RGlhbG9nLCB7fSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGhhc0ZlZWRiYWNrID0gQ291bnRseUFuYWx5dGljcy5pbnN0YW5jZS5jYW5FbmFibGUoKTtcbiAgICBjb25zdCBvbkZpbmlzaGVkID0gKHNlbmRGZWVkYmFjazogYm9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgICBpZiAoaGFzRmVlZGJhY2sgJiYgc2VuZEZlZWRiYWNrKSB7XG4gICAgICAgICAgICBDb3VudGx5QW5hbHl0aWNzLmluc3RhbmNlLnJlcG9ydEZlZWRiYWNrKHJhdGluZywgY29tbWVudCk7XG4gICAgICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdGZWVkYmFjayBzZW50JywgJycsIEluZm9EaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoJ0ZlZWRiYWNrIHNlbnQnKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3QoJ1RoYW5rIHlvdSEnKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHByb3BzLm9uRmluaXNoZWQoKTtcbiAgICB9O1xuXG4gICAgY29uc3QgYnJhbmQgPSBTZGtDb25maWcuZ2V0KCkuYnJhbmQ7XG5cbiAgICBsZXQgY291bnRseUZlZWRiYWNrU2VjdGlvbjtcbiAgICBpZiAoaGFzRmVlZGJhY2spIHtcbiAgICAgICAgY291bnRseUZlZWRiYWNrU2VjdGlvbiA9IDxSZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgIDxociAvPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9GZWVkYmFja0RpYWxvZ19zZWN0aW9uIG14X0ZlZWRiYWNrRGlhbG9nX3JhdGVBcHBcIj5cbiAgICAgICAgICAgICAgICA8aDM+eyBfdChcIlJhdGUgJShicmFuZClzXCIsIHsgYnJhbmQgfSkgfTwvaDM+XG5cbiAgICAgICAgICAgICAgICA8cD57IF90KFwiVGVsbCB1cyBiZWxvdyBob3cgeW91IGZlZWwgYWJvdXQgJShicmFuZClzIHNvIGZhci5cIiwgeyBicmFuZCB9KSB9PC9wPlxuICAgICAgICAgICAgICAgIDxwPnsgX3QoXCJQbGVhc2UgZ28gaW50byBhcyBtdWNoIGRldGFpbCBhcyB5b3UgbGlrZSwgc28gd2UgY2FuIHRyYWNrIGRvd24gdGhlIHByb2JsZW0uXCIpIH08L3A+XG5cbiAgICAgICAgICAgICAgICA8U3R5bGVkUmFkaW9Hcm91cFxuICAgICAgICAgICAgICAgICAgICBuYW1lPVwiZmVlZGJhY2tSYXRpbmdcIlxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17U3RyaW5nKHJhdGluZyl9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsocikgPT4gc2V0UmF0aW5nKHBhcnNlSW50KHIsIDEwKSBhcyBSYXRpbmcpfVxuICAgICAgICAgICAgICAgICAgICBkZWZpbml0aW9ucz17W1xuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogXCIxXCIsIGxhYmVsOiBcIvCfmKBcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogXCIyXCIsIGxhYmVsOiBcIvCfmJ5cIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogXCIzXCIsIGxhYmVsOiBcIvCfmJFcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogXCI0XCIsIGxhYmVsOiBcIvCfmIRcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyB2YWx1ZTogXCI1XCIsIGxhYmVsOiBcIvCfmI1cIiB9LFxuICAgICAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgaWQ9XCJmZWVkYmFja0NvbW1lbnRcIlxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoXCJBZGQgY29tbWVudFwiKX1cbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e190KFwiQ29tbWVudFwiKX1cbiAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17Y29tbWVudH1cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudD1cInRleHRhcmVhXCJcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhldikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0Q29tbWVudChldi50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9SZWFjdC5GcmFnbWVudD47XG4gICAgfVxuXG4gICAgbGV0IHN1YmhlYWRpbmc7XG4gICAgaWYgKGhhc0ZlZWRiYWNrKSB7XG4gICAgICAgIHN1YmhlYWRpbmcgPSAoXG4gICAgICAgICAgICA8aDI+eyBfdChcIlRoZXJlIGFyZSB0d28gd2F5cyB5b3UgY2FuIHByb3ZpZGUgZmVlZGJhY2sgYW5kIGhlbHAgdXMgaW1wcm92ZSAlKGJyYW5kKXMuXCIsIHsgYnJhbmQgfSkgfTwvaDI+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgbGV0IGJ1Z1JlcG9ydHMgPSBudWxsO1xuICAgIGlmIChTZGtDb25maWcuZ2V0KCkuYnVnX3JlcG9ydF9lbmRwb2ludF91cmwpIHtcbiAgICAgICAgYnVnUmVwb3J0cyA9IChcbiAgICAgICAgICAgIDxwPntcbiAgICAgICAgICAgICAgICBfdChcIlBSTyBUSVA6IElmIHlvdSBzdGFydCBhIGJ1ZywgcGxlYXNlIHN1Ym1pdCA8ZGVidWdMb2dzTGluaz5kZWJ1ZyBsb2dzPC9kZWJ1Z0xvZ3NMaW5rPiBcIiArXG4gICAgICAgICAgICAgICAgICAgIFwidG8gaGVscCB1cyB0cmFjayBkb3duIHRoZSBwcm9ibGVtLlwiLCB7fSwge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z0xvZ3NMaW5rOiBzdWIgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24ga2luZD1cImxpbmtcIiBvbkNsaWNrPXtvbkRlYnVnTG9nc0xpbmtDbGlja30+eyBzdWIgfTwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTwvcD5cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gKDxRdWVzdGlvbkRpYWxvZ1xuICAgICAgICBjbGFzc05hbWU9XCJteF9GZWVkYmFja0RpYWxvZ1wiXG4gICAgICAgIGhhc0NhbmNlbEJ1dHRvbj17ISFoYXNGZWVkYmFja31cbiAgICAgICAgdGl0bGU9e190KFwiRmVlZGJhY2tcIil9XG4gICAgICAgIGRlc2NyaXB0aW9uPXs8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICB7IHN1YmhlYWRpbmcgfVxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0ZlZWRiYWNrRGlhbG9nX3NlY3Rpb24gbXhfRmVlZGJhY2tEaWFsb2dfcmVwb3J0QnVnXCI+XG4gICAgICAgICAgICAgICAgPGgzPnsgX3QoXCJSZXBvcnQgYSBidWdcIikgfTwvaDM+XG4gICAgICAgICAgICAgICAgPHA+e1xuICAgICAgICAgICAgICAgICAgICBfdChcIlBsZWFzZSB2aWV3IDxleGlzdGluZ0lzc3Vlc0xpbms+ZXhpc3RpbmcgYnVncyBvbiBHaXRodWI8L2V4aXN0aW5nSXNzdWVzTGluaz4gZmlyc3QuIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiTm8gbWF0Y2g/IDxuZXdJc3N1ZUxpbms+U3RhcnQgYSBuZXcgb25lPC9uZXdJc3N1ZUxpbms+LlwiLCB7fSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdJc3N1ZXNMaW5rOiAoc3ViKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxhIHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIiBocmVmPXtleGlzdGluZ0lzc3Vlc1VybH0+eyBzdWIgfTwvYT47XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SXNzdWVMaW5rOiAoc3ViKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDxhIHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vcmVmZXJyZXIgbm9vcGVuZXJcIiBocmVmPXtuZXdJc3N1ZVVybH0+eyBzdWIgfTwvYT47XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH08L3A+XG4gICAgICAgICAgICAgICAgeyBidWdSZXBvcnRzIH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgeyBjb3VudGx5RmVlZGJhY2tTZWN0aW9uIH1cbiAgICAgICAgPC9SZWFjdC5GcmFnbWVudD59XG4gICAgICAgIGJ1dHRvbj17aGFzRmVlZGJhY2sgPyBfdChcIlNlbmQgZmVlZGJhY2tcIikgOiBfdChcIkdvIGJhY2tcIil9XG4gICAgICAgIGJ1dHRvbkRpc2FibGVkPXtoYXNGZWVkYmFjayAmJiAhcmF0aW5nfVxuICAgICAgICBvbkZpbmlzaGVkPXtvbkZpbmlzaGVkfVxuICAgIC8+KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEZlZWRiYWNrRGlhbG9nO1xuIl19